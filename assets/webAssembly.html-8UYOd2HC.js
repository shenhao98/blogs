import{_ as s,c as a,d as p,o as e}from"./app-E5rcR-Zh.js";const t={};function c(l,n){return e(),a("div",null,n[0]||(n[0]=[p(`<h2 id="外部注入-js-文件" tabindex="-1"><a class="header-anchor" href="#外部注入-js-文件"><span>外部注入 js 文件</span></a></h2><p>编写注入文件</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="pkg.js"><span>pkg.js</span></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token function">mergeInto</span><span class="token punctuation">(</span>LibraryManager<span class="token punctuation">.</span>library<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ciphertext<span class="token punctuation">,</span> cipherlength<span class="token punctuation">,</span> angle<span class="token punctuation">,</span> px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> bmp<span class="token punctuation">,</span> bmpLength<span class="token punctuation">,</span> len</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>在 C 代码中使用外部 js</p><div class="code-block-with-title"><div class="code-block-title-bar" data-title="demo.c"><span>demo.c</span></div><div class="language-c line-numbers-mode has-collapsed-lines collapsed" data-highlighter="prismjs" data-ext="c" style="--vp-collapsed-lines:15;"><pre><code class="language-c"><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h&gt;</span></span></span>
<span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;emscripten.h&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 定义小程序接收回调函数</span></span>
<span class="line">EMSCRIPTEN_KEEPALIVE</span>
<span class="line"><span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">uint8_t</span><span class="token operator">*</span> ciphertext<span class="token punctuation">,</span> <span class="token keyword">int</span> cipherlength<span class="token punctuation">,</span> <span class="token keyword">float</span> angle<span class="token punctuation">,</span> <span class="token keyword">float</span> px<span class="token punctuation">,</span> <span class="token keyword">float</span> py<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token class-name">uint8_t</span><span class="token operator">*</span> bmp<span class="token punctuation">,</span> <span class="token keyword">int</span> bmpLength<span class="token punctuation">,</span> <span class="token class-name">size_t</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">EMSCRIPTEN_KEEPALIVE</span>
<span class="line"><span class="token keyword">void</span> <span class="token function">Recognize</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token class-name">uint8_t</span><span class="token operator">*</span> bmpBuffer<span class="token punctuation">,</span>     <span class="token comment">// BMP图像数据缓冲区</span></span>
<span class="line">    <span class="token keyword">int</span> bufferLength<span class="token punctuation">,</span>             <span class="token comment">// 缓冲区长度</span></span>
<span class="line">    <span class="token keyword">int</span> seed<span class="token punctuation">,</span>                     <span class="token comment">// 随机种子</span></span>
<span class="line">    <span class="token keyword">int</span> maxblockcount<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token class-name">size_t</span> len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>bmpBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 模拟解密得到的密文</span></span>
<span class="line">    <span class="token class-name">uint8_t</span> abcdef_chars<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token char">&#39;A&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;B&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;C&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;D&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;E&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;F&#39;</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// ...其它代码</span></span>
<span class="line">    <span class="token keyword">float</span> angle<span class="token punctuation">,</span> px<span class="token punctuation">,</span> py<span class="token punctuation">;</span></span>
<span class="line">    angle <span class="token operator">=</span> <span class="token number">1.23f</span><span class="token punctuation">;</span></span>
<span class="line">    py <span class="token operator">=</span> <span class="token number">24.34f</span><span class="token punctuation">;</span></span>
<span class="line">    px <span class="token operator">=</span> <span class="token number">3.45f</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">call_alert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 返回结果</span></span>
<span class="line">    <span class="token function">callback</span><span class="token punctuation">(</span>abcdef_chars<span class="token punctuation">,</span> bufferLength<span class="token punctuation">,</span> angle <span class="token punctuation">,</span>px<span class="token punctuation">,</span> py<span class="token punctuation">,</span> bmpBuffer<span class="token punctuation">,</span> bufferLength<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div></div><p>打包命令</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">emcc --no-entry  demo.c --js-library pkg.js <span class="token parameter variable">-o</span> demo.wasm</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="内部注入-js" tabindex="-1"><a class="header-anchor" href="#内部注入-js"><span>内部注入 js</span></a></h2><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code class="language-c"><span class="line"><span class="token function">EM_JS</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">,</span> callback<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,9)]))}const i=s(t,[["render",c]]),u=JSON.parse('{"path":"/command/webAssembly.html","title":"","lang":"zh-CN","frontmatter":{},"git":{"updatedTime":1768289358000,"contributors":[{"name":"沈浩","username":"","email":"1204317466@qq.com","commits":1}],"changelog":[{"hash":"3c0d306a89419a18b07babe9087db811a104a572","time":1768289358000,"email":"1204317466@qq.com","author":"沈浩","message":"docs(.vuepress/config.js): 添加新导航菜单项并更新侧边栏配置"}]},"filePathRelative":"command/webAssembly.md"}');export{i as comp,u as data};
